---
// Original code: https://github.com/withastro/astro/blob/main/packages/integrations/image/components/Picture.astro
import { getPicture } from "@astrojs/image";
import { warnForMissingAlt } from "@astrojs/image/components";

const {
  src,
  alt,
  sizes,
  widths,
  aspectRatio,
  fit,
  background,
  position,
  formats = ["avif", "webp"],
  loading = "lazy",
  decoding = "async",
  caption,
  ...attrs
} = Astro.props;

if (alt === undefined || alt === null) {
  warnForMissingAlt();
}

const { image, sources } = await getPicture({
  src,
  widths,
  formats,
  aspectRatio,
  fit,
  background,
  position,
  alt,
});
---

<figure>
  <picture>
    {sources.map((attrs) => <source sizes={sizes} {...attrs} />)}
    <img loading={loading} decoding={decoding} {...image} {...attrs} />
  </picture>
  <figcaption>
    {caption}
  </figcaption>
</figure>
